---
- name: Playbook to configure a PHP app on a LEMP stack 
  hosts: all
  remote_user: emmanuel.apreko
  become: true
  vars_files:
    - vars/main.yml

  tasks:
    - name: Create app directories
      ansible.builtin.file:
        path: "{{ item[1] }}/{{ lookup('user', item[0]) }}"
        owner: "{{ lookup('user', item[0]) }}"
        group: "{{ lookup('user', item[0]) }}"
        mode: '0700'
        state: directory
      with_nested:
        - "{{ app_username }}"
        - [ '/var/log/php-fpm/','/var/lib/php/sessions/','/var/www/' ]